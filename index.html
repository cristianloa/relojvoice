<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reloj Casio PERFECTO - Voz 12h/24h Corregida</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons/css/all/all.css">
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{
            margin:0;height:100dvh;background:#000;color:#00ff41;
            font-family:'JetBrains Mono',monospace;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            overflow:hidden;position:relative;touch-action:manipulation;
        }
        body.light{background:#f8f8f8;color:#000}

        #reloj{
            font-size:18vw;font-weight:800;letter-spacing:0.06em;
            text-shadow:0 0 50px #00ff41;user-select:none;
        }
        @media (min-width:500px){#reloj{font-size:15vw}}
        @media (min-width:800px){#reloj{font-size:12vw}}
        body.light #reloj{text-shadow:0 0 50px #000;color:#000}

        .digito{display:inline-block;width:0.59em;text-align:center}
        .puntos{display:inline-block;width:0.5em;text-align:center;animation:parpadeo 1s steps(2,start) infinite}
        @keyframes parpadeo{to{opacity:0}}
        @keyframes flashColon{0%,100%{opacity:1}50%{opacity:0}}
        .flash .puntos{animation:flashColon 0.4s ease-in-out 10 alternate}

        #secondary{
            margin-top:20px;font-size:5vw;font-weight:600;opacity:0.8;
            text-align:center;transition:all .4s;min-height:40px;
        }
        @media (min-width:600px){#secondary{font-size:3.5vw}}

        #themeBtn{
            position:fixed;top:18px;left:18px;z-index:100;
            font-size:1.8rem;cursor:pointer;
            width:44px;height:44px;border-radius:50%;
            background:rgba(255,255,255,0.12);backdrop-filter:blur(12px);
            display:flex;align-items:center;justify-content:center;
            transition:all .3s;box-shadow:0 0 20px rgba(0,255,65,0.3);
        }
        body.light #themeBtn{background:rgba(0,0,0,0.12);box-shadow:0 0 20px rgba(0,0,0,0.3)}

        #hamburger{
            position:fixed;top:18px;right:18px;z-index:100;
            width:44px;height:44px;display:flex;flex-direction:column;justify-content:center;align-items:center;
            cursor:pointer;gap:5px;padding:8px;border-radius:50%;
            background:rgba(255,255,255,0.12);backdrop-filter:blur(12px);
            box-shadow:0 0 20px rgba(0,255,65,0.3);
        }
        body.light #hamburger{background:rgba(0,0,0,0.12);box-shadow:0 0 20px rgba(0,0,0,0.3)}
        .bar{width:26px;height:4px;background:#00ff41;border-radius:3px;transition:all .3s}
        body.light .bar{background:#000}
        #hamburger.open .bar:nth-child(1){transform:rotate(45deg) translate(6px,6px)}
        #hamburger.open .bar:nth-child(2){opacity:0}
        #hamburger.open .bar:nth-child(3){transform:rotate(-45deg) translate(6px,-6px)}

        #overlay{position:fixed;top:0;left:0;width:100%;height:100dvh;background:rgba(0,0,0,0.7);opacity:0;pointer-events:none;transition:opacity .35s;z-index:98;}
        #overlay.open{opacity:1;pointer-events:all}

        #sidebar{position:fixed;top:0;right:-100%;height:100dvh;background:rgba(0,0,0,0.98);padding:80px 30px 30px;overflow-y:auto;transition:right .35s ease;z-index:99;}
        body.light #sidebar{background:rgba(255,255,255,0.98);color:#000}
        @media (min-width:768px){#sidebar{width:50%;max-width:500px;right:-50%}#sidebar.open{right:0}}
        @media (max-width:767px){#sidebar{width:100%;right:-100%}#sidebar.open{right:0}}

        .seccion{margin:25px 0;padding:20px;background:rgba(0,255,65,.08);border-radius:14px}
        body.light .seccion{background:rgba(0,0,0,.07)}
        h3{margin:0 0 20px;font-size:1.5rem;color:#0f8;text-align:center}
        body.light h3{color:#080}

        .btn{display:block;width:100%;margin:14px 0;padding:18px;background:rgba(0,255,65,.15);border:2px solid #00ff41;border-radius:12px;text-align:center;font-size:1.2rem;cursor:pointer;font-weight:600;transition:all .2s;}
        body.light .btn{background:rgba(0,0,0,.1);border-color:#000}
        .btn.add{background:rgba(0,255,65,.7)!important;color:#000}
        body.light .btn.add{background:rgba(0,0,0,.6)!important;color:#0f0}

        .input-row{display:flex;gap:15px;align-items:center;justify-content:center;margin:20px 0}
        input[type=number]{width:90px;padding:16px;font-size:1.5rem;background:rgba(0,0,0,0.7);color:#0f0;border:2px solid #0f0;border-radius:12px;text-align:center;font-family:inherit;}
        body.light input[type=number]{background:rgba(255,255,255,0.9);color:#000;border-color:#000}

        .alarma-item{display:flex;justify-content:space-between;align-items:center;background:rgba(0,255,65,.1);padding:12px;margin:8px 0;border-radius:10px;font-size:1.2rem;}
        .alarma-item button{background:#f55;color:#fff;border:none;padding:8px 12px;border-radius:8px}
    </style>
</head>
<body>

<div id="reloj">
    <span class="digito" id="h1">0</span><span class="digito" id="h2">0</span
    ><span class="puntos">:</span
    ><span class="digito" id="m1">0</span><span class="digito" id="m2">0</span
    ><span class="puntos">:</span
    ><span class="digito" id="s1">0</span><span class="digito" id="s2">0</span>
</div>

<div id="secondary"></div>

<div id="themeBtn"><i class="fi fi-rr-moon-stars"></i></div>

<div id="hamburger">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
</div>

<div id="overlay"></div>

<div id="sidebar">
    <div class="seccion">
        <h3>Reloj</h3>
        <button class="btn on" id="auto">Cada hora: ON</button>
        <button class="btn on" id="formato">Formato: 24h</button>
    </div>

    <div class="seccion">
        <h3>Alarmas (máx. 3)</h3>
        <div class="input-row">
            <input type="number" id="newH" min="0" max="23" value="7">
            <span style="font-size:2.5rem">:</span>
            <input type="number" id="newM" min="0" max="59" value="0">
            <button class="btn add" id="addAlarm">+ Agregar</button>
        </div>
        <div id="listaAlarmas"></div>
    </div>

    <div class="seccion">
        <h3>Temporizador</h3>
        <div class="input-row">
            <input type="number" id="timerH" min="0" value="0"> :
            <input type="number" id="timerM" min="0" max="59" value="5"> :
            <input type="number" id="timerS" min="0" max="59" value="0">
        </div>
        <button class="btn" id="startTimer">Iniciar</button>
        <button class="btn" id="pauseTimer" style="display:none">Pausar</button>
        <button class="btn" id="cancelTimer" style="display:none">Cancelar</button>
    </div>
</div>

<script>
    const h1 = document.getElementById('h1'), h2 = document.getElementById('h2');
    const m1 = document.getElementById('m1'), m2 = document.getElementById('m2');
    const s1 = document.getElementById('s1'), s2 = document.getElementById('s2');
    const reloj = document.getElementById('reloj');
    const secondary = document.getElementById('secondary');
    const themeBtn = document.getElementById('themeBtn');
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const listaAlarmas = document.getElementById('listaAlarmas');

    let es24h = true, autoOn = true;
    let alarmas = [];
    let timerActivo = false, timerPausado = false, timerSegundosRestantes = 0, timerInterval = null;

    // === FUNCIÓN PARA DECIR LA HORA EN ESPAÑOL NATURAL (12h/24h) ===
    function decirHora() {
        const ahora = new Date();
        const h24 = ahora.getHours();
        const m = ahora.getMinutes();

        let texto = "";

        if (es24h) {
            if (m === 0) texto = `Son las ${h24} en punto`;
            else if (m === 1) texto = `Es la ${h24} y un minuto`;
            else texto = `Son las ${h24} y ${m}`;
        } else {
            let h12 = h24 % 12 || 12;
            let periodo = h24 < 12 ? "de la mañana" : h24 < 21 ? "de la tarde" : "de la noche";

            if (h24 === 0 && m === 0) texto = "Es medianoche";
            else if (h24 === 12 && m === 0) texto = "Es mediodía";
            else if (m === 0) texto = h12 === 1 ? `Es la una en punto ${periodo}` : `Son las ${h12} en punto ${periodo}`;
            else if (m === 1) texto = h12 === 1 ? `Es la una y un minuto ${periodo}` : `Son las ${h12} y un minuto ${periodo}`;
            else texto = h12 === 1 ? `Es la una y ${m} ${periodo}` : `Son las ${h12} y ${m} ${periodo}`;
        }

        hablar(texto);
    }

    function hablar(texto) {
        const u = new SpeechSynthesisUtterance(texto);
        u.lang = 'es-ES';
        u.rate = 0.9;
        speechSynthesis.speak(u);
    }

    // === RESTO DEL CÓDIGO (todo igual, solo corregida la voz) ===
    themeBtn.onclick = e => {
        e.stopPropagation();
        document.body.classList.toggle('light');
        const icon = themeBtn.querySelector('i');
        icon.className = document.body.classList.contains('light') ? 'fi fi-rr-sun' : 'fi fi-rr-moon-stars';
    };

    function toggleMenu() {
        hamburger.classList.toggle('open');
        sidebar.classList.toggle('open');
        overlay.classList.toggle('open');
    }
    hamburger.onclick = e => { e.stopPropagation(); toggleMenu(); };
    overlay.onclick = () => { if (sidebar.classList.contains('open')) toggleMenu(); };

    document.body.onclick = e => {
        if (e.target.closest('#sidebar') || e.target.closest('#hamburger') || e.target.closest('#themeBtn')) return;
        if (sidebar.classList.contains('open')) return;
        decirHora();
    };

    // Alarmas, temporizador, reloj... (todo igual que en la versión anterior)

    document.getElementById('addAlarm').onclick = () => {
        if (alarmas.length >= 3) return alert("Máximo 3 alarmas");
        const h = parseInt(document.getElementById('newH').value) || 0;
        const m = parseInt(document.getElementById('newM').value) || 0;
        if (h < 0 || h > 23 || m < 0 || m > 59) return alert("Hora inválida");
        alarmas.push({h, m, id: Date.now()});
        renderAlarmas();
        actualizarSecondary();
    };

    function renderAlarmas() {
        listaAlarmas.innerHTML = '';
        alarmas.forEach(a => {
            const div = document.createElement('div');
            div.className = 'alarma-item';
            div.innerHTML = `Alarma ${a.h.toString().padStart(2,'0')}:${a.m.toString().padStart(2,'0')} 
                <button onclick="eliminarAlarma(${a.id})">Eliminar</button>`;
            listaAlarmas.appendChild(div);
        });
    }
    window.eliminarAlarma = id => {
        alarmas = alarmas.filter(a => a.id !== id);
        renderAlarmas();
        actualizarSecondary();
    };

    // Temporizador (igual, con parpadeo y sonido)
    document.getElementById('startTimer').onclick = () => {
        const h = parseInt(document.getElementById('timerH').value)||0;
        const m = parseInt(document.getElementById('timerM').value)||0;
        const s = parseInt(document.getElementById('timerS').value)||0;
        timerSegundosRestantes = h*3600 + m*60 + s;
        if (timerSegundosRestantes <= 0) return;

        timerActivo = true;
        document.getElementById('startTimer').style.display = 'none';
        document.getElementById('pauseTimer').style.display = 'block';
        document.getElementById('cancelTimer').style.display = 'block';

        timerInterval = setInterval(() => {
            if (timerPausado) return;
            if (--timerSegundosRestantes <= 0) {
                clearInterval(timerInterval);
                timerActivo = false;
                secondary.textContent = "¡TERMINADO!";
                secondary.style.fontSize = "7vw";
                reloj.classList.add('flash');
                hablar("¡Temporizador terminado!");
                if ("vibrate" in navigator) navigator.vibrate([1000,500,1000,500,1000]);
                setTimeout(() => {
                    reloj.classList.remove('flash');
                    secondary.textContent = "";
                    document.getElementById('startTimer').style.display = 'block';
                    document.getElementById('pauseTimer').style.display = 'none';
                    document.getElementById('cancelTimer').style.display = 'none';
                    actualizarSecondary();
                }, 5000);
                return;
            }
            const hh = Math.floor(timerSegundosRestantes/3600).toString().padStart(2,'0');
            const mm = Math.floor((timerSegundosRestantes%3600)/60).toString().padStart(2,'0');
            const ss = (timerSegundosRestantes%60).toString().padStart(2,'0');
            secondary.textContent = `${hh}:${mm}:${ss}`;
            secondary.style.fontSize = "7vw";
        }, 1000);
    };

    document.getElementById('pauseTimer').onclick = () => {
        timerPausado = !timerPausado;
        document.getElementById('pauseTimer').textContent = timerPausado ? 'Reanudar' : 'Pausar';
    };

    document.getElementById('cancelTimer').onclick = () => {
        clearInterval(timerInterval);
        timerActivo = false;
        secondary.textContent = "";
        document.getElementById('startTimer').style.display = 'block';
        document.getElementById('pauseTimer').style.display = 'none';
        document.getElementById('cancelTimer').style.display = 'none';
        actualizarSecondary();
    };

    function actualizarReloj() {
        const ahora = new Date();
        let horas = es24h ? ahora.getHours() : (ahora.getHours() % 12 || 12);
        const hh = horas.toString().padStart(2,'0');
        const mm = ahora.getMinutes().toString().padStart(2,'0');
        const ss = ahora.getSeconds().toString().padStart(2,'0');

        h1.textContent = hh[0]; h2.textContent = hh[1];
        m1.textContent = mm[0]; m2.textContent = mm[1];
        s1.textContent = ss[0]; s2.textContent = ss[1];

        if (autoOn && mm === '00' && ss === '00') decirHora();

        alarmas.forEach(a => {
            if (a.h === ahora.getHours() && a.m === ahora.getMinutes() && ahora.getSeconds() === 0) {
                secondary.textContent = `¡ALARMA! ${a.h}:${a.m.toString().padStart(2,'0')}`;
                secondary.style.fontSize = "7vw";
                reloj.classList.add('flash');
                decirHora();
                hablar("¡Despierta!");
                if ("vibrate" in navigator) navigator.vibrate([500,300,500]);
                setTimeout(() => reloj.classList.remove('flash'), 5000);
            }
        });

        if (!timerActivo) actualizarSecondary();
    }

    function actualizarSecondary() {
        if (timerActivo || alarmas.length === 0) {
            if (!timerActivo) secondary.textContent = '';
            return;
        }
        const ahora = new Date();
        const actualMin = ahora.getHours() * 60 + ahora.getMinutes();
        let menorDiff = 1440, proxima = null;
        alarmas.forEach(a => {
            const diff = (a.h * 60 + a.m - actualMin + 1440) % 1440;
            if (diff < menorDiff) { menorDiff = diff; proxima = a; }
        });
        if (proxima && menorDiff < 1440) {
            const hh = Math.floor(menorDiff / 60).toString().padStart(2,'0');
            const mm = (menorDiff % 60).toString().padStart(2,'0');
            secondary.textContent = `Próxima: ${proxima.h.toString().padStart(2,'0')}:${proxima.m.toString().padStart(2,'0')} en ${hh}:${mm}`;
            secondary.style.fontSize = "4.5vw";
        }
    }

    document.getElementById('formato').onclick = () => {
        es24h = !es24h;
        document.getElementById('formato').classList.toggle('on');
        document.getElementById('formato').textContent = `Formato: ${es24h?'24h':'12h'}`;
        actualizarReloj();
    };

    document.getElementById('auto').onclick = () => {
        autoOn = !autoOn;
        document.getElementById('auto').classList.toggle('on');
        document.getElementById('auto').textContent = `Cada hora: ${autoOn?'ON':'OFF'}`;
    };

    setInterval(actualizarReloj, 1000);
    actualizarReloj();
    renderAlarmas();
</script>
</body>
</html>
